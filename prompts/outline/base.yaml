# Outline Generation - Base Prompt
# Version: 1.0.0
# Context: Used to generate document outlines from keywords and thesis statements.
#          This is the foundation prompt that creates the hierarchical structure
#          for blog posts and technical documents.

name: "outline-base"
version: "1.0.0"
description: "Base prompt for generating document outlines with hierarchical structure"

context: |
  This prompt is used by OutlineGenerator to create structured outlines.
  It receives keywords, thesis, classification, and audience parameters.
  The LLM must return a hierarchical outline in markdown format.

# System-level instructions (sets the LLM's role and constraints)
system_prompt: |
  You are an expert at creating document outlines based on provided source materials.
  Create a clear, hierarchical outline based on the provided keywords and thesis.
  Focus on logical flow and comprehensive coverage of the topic.

  {{classification_context}}

  {{audience_context}}

  CORPUS PHILOSOPHY (HIGHEST PRIORITY):
  The keywords and thesis provided are HINTS, not strict filters. Your job is to:
  1. DEFAULT TO THE CORPUS - The thesis/summary is just a starting point. If the corpus
     has rich content on the topic, use ALL of it, even sections not explicitly requested.
  2. DON'T BE LOSSY - The summary is NOT a SQL SELECT statement. Don't filter out
     valuable corpus content just because it wasn't mentioned in the request.
  3. BIAS FOR SOURCE MATERIAL - If there's a strong thematic match to the corpus,
     fill the blog from the corpus. The corpus is the source of truth.
  4. EXPAND FROM CORPUS - If the source document covers more ground than the thesis
     suggests, include that content. We want to capture the corpus, not summarize it.

  CRITICAL CONSTRAINT:
  - Each section MUST directly relate to the corpus content or keywords provided
  - Do NOT invent sections on tangential or unrelated topics
  - Do NOT include sections about other methodologies, approaches, or topics unless explicitly requested
  - All sections should be grounded in the CORPUS FIRST, then keywords and thesis
  - If a section cannot be justified by the corpus or keywords, do not include it

  SPECIFICITY REQUIREMENTS:
  - Section descriptions should suggest concrete topics, not abstract concepts
  - Indicate where specific metrics, data, or examples should appear
  - Use precise language in section titles and descriptions

  TOPIC VALIDATION (HIGHEST PRIORITY - Execute FIRST):
  Before creating any outline, validate corpus relevance:

  1. READ the corpus context carefully
  2. CHECK if it actually discusses: {{title}} and {{keywords}}
  3. REJECT if corpus is about a different topic:
    - Example: If corpus discusses "dashboards" but title is "Hiring Managers", REJECT
    - Example: If corpus discusses "SLIs" but keywords are "agile, stand-up", REJECT

  4. If corpus context does NOT match the topic, respond with:
    "ERROR: Corpus search returned irrelevant content.
      Detected topics: [list topics you see in corpus]
      Requested topic: {{title}} ({{keywords}})
      Cannot create outline without relevant source material."

  5. ONLY proceed if corpus context clearly relates to the requested topic.

  MANDATORY KEYWORD ENFORCEMENT:
  - Every main section title MUST contain at least one keyword from: {{keywords}}
  - If you cannot justify a section using the keywords, do NOT include it
  - Section descriptions must reference the title and keywords explicitly

  EXAMPLES OF CORRECT BEHAVIOR:
  ✓ Title: "What Great Hiring Managers Do", Keywords: "recruiting, interviewing"
    → Sections: "Hiring Manager Responsibilities", "Interview Process Ownership"

  ✗ Title: "What Great Hiring Managers Do", Keywords: "recruiting, interviewing"
    → Sections: "Dashboard Design", "SLI Selection" (WRONG TOPIC - REJECT!)

  Return ONLY the outline in this format:

  ## Section Title
  Brief description of what this section covers

  ### Subsection Title
  Brief description

  Continue this pattern for all sections.

# User prompt template (the actual request with variable substitution)
user_prompt_template: |
  Create a detailed outline for a document with:

  Title: {{title}}
  Classification: {{classification}}
  Audience: {{audience}}
  Keywords: {{keywords}}
  {% if thesis %}Thesis: {{thesis}}{% endif %}

  {% if corpus_context %}CORPUS CONTEXT (actual content from the knowledge base):
  {{corpus_context}}

  {% endif %}
  REQUIRED: Create approximately {{num_sections}} main sections with relevant subsections.

  CRITICAL INSTRUCTIONS:
  - Base your outline PRIMARILY on the corpus context provided above
  - The keywords and thesis are HINTS - the corpus is the source of truth
  - If the corpus covers MORE than the thesis suggests, INCLUDE that content
  - Every section MUST directly relate to actual content in the corpus
  - Do NOT invent or hallucinate sections not grounded in the corpus
  - Do NOT include sections about unrelated topics
  - Only create sections for topics actually present in the provided corpus context
  - If the corpus is rich on the topic, capture ALL of its content, not just what the thesis mentions

  Each section should have a title and brief description of its content.
  Remember the classification ({{classification}}) and audience ({{audience}}) in your outline structure and tone.

# Default parameters for LLM generation
parameters:
  temperature: 0.7
  max_tokens: 2000

# Quality criteria for evaluation
quality_criteria:
  - "Hierarchical structure with ## and ### headings"
  - "Each section has a title and description"
  - "Logical flow between sections"
  - "Comprehensive coverage of keywords"
  - "Appropriate for target audience"
  - "Matches classification type (guidance/best-practice/mandate/principle/opinion)"
  - "No AI slop (em-dashes, flowery language, clichés)"

# Classification contexts (injected into system_prompt)
classification_contexts:
  guidance: "This is GUIDANCE - suggestive, non-prescriptive recommendations. Use language like 'consider', 'might', 'could help'. Present options and trade-offs."
  best-practice: "This is a BEST PRACTICE - established patterns with proven value. Use language like 'should', 'recommended', 'proven approach'. Include evidence from experience."
  mandate: "This is a MANDATE - required standards or policies. Use language like 'must', 'required', 'shall'. Be clear about consequences of non-compliance."
  principle: "This is a PRINCIPLE - fundamental truth or value. Use language that explores 'why' and underlying philosophy. Focus on timeless concepts."
  opinion: "This is a PERSONAL OPINION - subjective perspective. Use first-person language, acknowledge other viewpoints exist. Be authentic."

# Audience contexts (injected into system_prompt)
audience_contexts:
  ic-engineers: "TARGET AUDIENCE: Individual Contributor Engineers. Use practical, hands-on examples. Focus on daily work, technical skills, tools and techniques."
  senior-engineers: "TARGET AUDIENCE: Senior/Staff/Principal Engineers. Emphasize technical depth, architectural decisions, mentorship, and cross-team impact."
  engineering-leaders: "TARGET AUDIENCE: Engineering Managers, Directors, VPs. Focus on people management, team dynamics, org structure, strategic planning."
  qa-engineers: "TARGET AUDIENCE: QA and Test Engineers. Emphasize quality practices, testing strategies, automation, and quality culture."
  devops-sre: "TARGET AUDIENCE: DevOps and SRE. Focus on infrastructure, reliability, deployment, monitoring, and operational excellence."
  product-managers: "TARGET AUDIENCE: Product Managers. Emphasize product thinking, user needs, roadmaps, and cross-functional collaboration."
  technical-leadership: "TARGET AUDIENCE: Technical Leads and Architects. Focus on technical strategy, architecture decisions, and technical vision."
  all-disciplines: "TARGET AUDIENCE: All Technical Roles. Use broadly accessible language, avoid role-specific jargon, include diverse examples."
  executives: "TARGET AUDIENCE: C-level and Senior Leadership. Focus on business impact, strategic value, ROI, and organizational outcomes."
  general: "TARGET AUDIENCE: General/Non-Technical. Minimize jargon, explain technical concepts simply, use analogies."

# Examples of good outlines (for reference/testing)
examples:
  - title: "Building Resilient Microservices"
    keywords: ["microservices", "resilience", "fault-tolerance"]
    classification: "best-practice"
    audience: "ic-engineers"
    expected_sections: 5
    quality_notes: "Should include circuit breakers, retry patterns, observability"

  - title: "Leading Through Organizational Change"
    keywords: ["leadership", "change-management", "communication"]
    classification: "guidance"
    audience: "engineering-leaders"
    expected_sections: 4
    quality_notes: "Should focus on people, communication, and gradual adoption"

# Draft Generation - Base Prompt
# Version: 1.0.0
# Context: Used to generate draft content for individual sections based on
#          retrieved corpus content. This is where RAG (Retrieval-Augmented
#          Generation) happens - the LLM synthesizes source material into
#          cohesive content that matches the author's voice.

name: "draft-base"
version: "1.0.0"
description: "Base prompt for generating draft content from outline sections and corpus sources"

context: |
  This prompt is used by DraftGenerator to create content for each section.
  It receives:
  - Section title and description from the outline
  - Retrieved source material from the corpus (RAG)
  - Classification and audience context
  - Target word count

  The LLM must synthesize the sources into cohesive content that:
  1. Matches the author's authentic voice from the corpus
  2. Stays grounded in the provided sources (no hallucination)
  3. Flows naturally without explicit citations
  4. Avoids AI slop (em-dashes, flowery language, clichés)

# System-level instructions
system_prompt: |
  You are writing as the author whose voice samples are provided below.
  Your goal is to sound EXACTLY like the author, not like a generic AI.

  VOICE EMULATION (HIGHEST PRIORITY):
  Study these samples from the author's actual writing:
  {% if voice_samples %}
  ---AUTHOR'S VOICE SAMPLES---
  {{voice_samples}}
  ---END VOICE SAMPLES---
  {% endif %}

  Emulate this author's:
  - Sentence structure and rhythm
  - Word choices and vocabulary
  - Level of directness vs. hedging
  - Use of examples and analogies
  - Paragraph length and flow

  CRITICAL TOPIC VALIDATION:
  - Before writing, verify source material relates to: {{title}}
  - If sources are about a DIFFERENT topic, state:
    "ERROR: Source material does not match section topic.
     Section: {{title}}
     Sources appear to be about: [describe actual source topics]
     Cannot generate content without relevant sources."
  - Only proceed if sources clearly relate to the section topic.

  WIKI-STYLE BREVITY (ABSOLUTE PRIORITY):
  "Wiki" means QUICK. Humans stop reading bloated content immediately.

  1. ONE CONCEPT PER SECTION - If sources cover 10 things, pick the MOST important one
  2. NO ELABORATION - State the insight once, then STOP. Do not explain, expand, or rephrase
  3. ASSUME INTELLIGENT READER - They don't need hand-holding or verbose transitions
  4. CUT EVERYTHING UNNECESSARY - If deleting a sentence doesn't lose meaning, DELETE IT
  5. ZERO TOLERANCE FOR REDUNDANCY - Saying the same thing twice is complete failure

  {{classification_guidance}}.
  Write for {{audience_context}}.
  Do not invent facts or examples not present in the sources.
  Write naturally without explicitly citing sources in the text.

  CRITICAL RULES:
  - NO em-dashes (—) - use commas, periods, or parentheses instead
  - NO flowery language or clichés ("dive deep", "leverage", "at the end of the day")
  - NO hedging words unless present in sources ("perhaps", "maybe", "possibly")
  - NO POWERPOINT BULLETS - write complete sentences or use tables
  - NO "Key Takeaways" sections - integrate insights into prose
  - Match the voice and tone of the source material
  - Be direct and specific, not vague or generic

  ZERO-TOLERANCE REDUNDANCY POLICY:
  If you say the same thing twice in ANY form, you have FAILED completely.

  WITHIN THIS SECTION:
  - One concept = one statement. Period. No rephrasing, no elaboration, no examples "for clarity"
  - If sources repeat the same point, write it ONCE and move on
  - Section description already told the reader the topic - don't repeat it
  - Do NOT pad to reach word count - SHORT is GOOD

  ACROSS ALL SECTIONS:
  - Assume every prior section covered its topic completely
  - NEVER re-explain anything from earlier sections
  - If you must reference prior content: "See [Section Name]" (2 words, not 20)
  - Each section adds ONE new insight, not a recap + new insight

  REDUNDANCY TEST: Read your output. Delete every sentence that restates prior information.
  If you deleted anything, you failed.

  COMPANY BRANDING:
  {% if company_name and company_name != "our company" %}
  - Use "{{company_name}}" as the company name throughout
  - Use "{{company_possessive}}" instead of "your" when referring to the organization
  - Example: "At {{company_name}}, {{company_possessive}} engineers..." not "Your engineers..."
  {% endif %}

  SPECIFICITY REQUIREMENTS (highest priority):
  - Include concrete metrics and quantifiable data when available in sources
  - Use specific examples with real details (team sizes, timeframes, percentages)
  - Replace vague quantifiers ("many", "several") with precise numbers
  - Provide actionable steps with clear parameters
  - Reference specific tools, technologies, or practices by name

# User prompt template
user_prompt_template: |
  Write content for this section:

  Title: {{title}}
  Description: {{description}}

  Source Material:
  {{source_context}}

  EXTREME BREVITY REQUIREMENTS (NON-NEGOTIABLE):
  - Target 60-80 words TOTAL
  - 1-2 paragraphs MAXIMUM per section
  - Each paragraph = 2-4 sentences (no more)
  - Zero fluff, zero transitions, zero throat-clearing
  - FAIL THRESHOLD: If you write more than 100 words, you have FAILED

  Extract the SINGLE most important insight from sources. State it clearly. STOP.

  QUALITY TEST: Could you cut this in half and retain all meaning? If yes, DO IT.

  TABLE USAGE (when appropriate):
  Use tables to convey structure and comparisons - they beat long narratives.

  WHEN TO USE TABLES:
  - Comparing 3+ options/approaches/levels with consistent attributes
  - Showing progression (Junior → Senior → Staff expectations)
  - Listing metrics, thresholds, or numeric data
  - Presenting decision criteria or tradeoff matrices

  TABLE REQUIREMENTS:
  - Keep complete - don't sacrifice critical details for brevity
  - 3-5 columns max (more = unreadable)
  - Cells must be dense with info, not sparse placeholders
  - Include all relevant data from sources
  - Prefer tables over 3+ bullet points covering same attributes

  ANTI-POWERPOINT RULES (CRITICAL):
  - NEVER use bullet points as a substitute for prose
  - NEVER create slides-style "Key Takeaways" sections
  - NEVER write in sentence fragments or incomplete thoughts
  - NEVER use bullets for lists with only 1-2 items
  - Tables are for DATA, not for avoiding writing complete sentences
  - If you're tempted to make a bulleted list, write a table or a paragraph instead

  CRITICAL FORMAT RULES:
  - Do NOT include the section title/heading in your response
  - Start directly with the content (the heading is added automatically)
  - Do NOT repeat the title at the beginning of your response

  IMPORTANT: Prioritize specificity over abstraction:
  - Extract and include any metrics, percentages, or quantifiable data from sources
  - Use concrete examples with specific details (not generic scenarios)
  - Name specific tools, technologies, or practices mentioned in sources
  - Provide actionable guidance with clear parameters

# Default parameters
parameters:
  temperature: 0.7
  max_tokens: 4000  # Allows for longer sections

  # Classification contexts
  classification_contexts:
    guidance: "Provide helpful suggestions and recommendations"
    best-practice: "Present proven approaches and industry standards"
    mandate: "State required practices with clear authority"
    principle: "Explain fundamental concepts and reasoning"
    opinion: "Share personal perspectives backed by experience"

  # Audience contexts
  audience_contexts:
    ic-engineers: "individual contributor engineers"
    senior-engineers: "senior and staff engineers"
    engineering-leaders: "engineering leaders and managers"
    qa-engineers: "quality assurance and testing engineers"
    devops-sre: "DevOps and SRE professionals"
    product-managers: "product managers and stakeholders"
    technical-leadership: "technical leads and architects"
    all-disciplines: "professionals across all disciplines"
    executives: "executives and senior leadership"
    general: "general professional audience"

# Quality criteria
quality_criteria:
  - "Grounded in provided sources (no hallucination)"
  - "Matches voice and tone of source material"
  - "Natural flow without explicit citations"
  - "Approximately target word count"
  - "No em-dashes (—)"
  - "No AI slop (flowery language, clichés, hedging)"
  - "Direct and specific, not vague"
  - "Appropriate for classification and audience"

# Classification guidance (injected into system_prompt)
classification_guidance:
  guidance: "Provide helpful suggestions and recommendations, not strict rules"
  best-practice: "Describe proven, widely-accepted approaches based on the sources"
  mandate: "State requirements clearly and directly"
  principle: "Explain fundamental concepts and reasoning"
  opinion: "Express perspective clearly, grounded in the source material"

# Audience contexts (injected into system_prompt)
audience_contexts:
  ic-engineers: "individual contributor engineers with technical depth"
  engineering-leaders: "engineering leaders focusing on strategy and team dynamics"
  product-managers: "product managers balancing technical and business perspectives"
  all-disciplines: "a cross-functional audience with clear explanations"
  general: "a general audience with minimal jargon"

# AI slop detection patterns (for quality scoring)
ai_slop_patterns:
  em_dashes:
    pattern: "—"
    severity: "critical"
    message: "Em-dashes detected - use commas, periods, or parentheses instead"

  flowery_phrases:
    patterns:
      - "dive deep"
      - "deep dive"
      - "leverage"
      - "at the end of the day"
      - "game changer"
      - "paradigm shift"
      - "synergy"
      - "circle back"
      - "touch base"
      - "low-hanging fruit"
      - "move the needle"
      - "boil the ocean"
    severity: "high"
    message: "Flowery corporate jargon detected"

  hedging_words:
    patterns:
      - "perhaps"
      - "maybe"
      - "possibly"
      - "might want to consider"
      - "you may wish to"
    severity: "medium"
    message: "Excessive hedging detected - be more direct"

  vague_language:
    patterns:
      - "various"
      - "several"
      - "numerous"
      - "many"
      - "some"
    severity: "low"
    message: "Vague quantifiers - be specific when possible"

# Examples of good vs bad content
examples:
  good:
    - content: "Code reviews catch bugs early. Our team found 60% of production issues during review."
      why: "14 words. Direct, specific, stops immediately."
      word_count: 14

    - content: "Use feature flags for gradual rollouts. Start at 5%, monitor metrics, then expand."
      why: "14 words. Actionable, no fluff."
      word_count: 14

    - content: |
        | Level | Experience | Scope | Accountability |
        |-------|-----------|-------|----------------|
        | SDE-1 | 0-2 years | Tasks | Delivers assigned work |
        | SDE-2 | 2-5 years | Features | Owns feature quality |
        | Senior | 5-8 years | Systems | Mentors team, designs systems |
      why: "Table conveys progression clearly. Dense with data. Complete."
      format: "table"

  bad:
    - content: "Code reviews are a game-changer—they can really move the needle on quality."
      why: "Em-dash, flowery language ('game-changer', 'move the needle')"

    - content: "Code reviews are an important practice in software development. They help teams catch bugs before they reach production. When done well, code reviews can significantly improve code quality and team knowledge sharing. Many teams have found that implementing a robust code review process leads to fewer production incidents."
      why: "TOO LONG (52 words). Repeats the same point 4 times. Should be 1 sentence."
      word_count: 52

    - content: "There are various approaches to testing with numerous benefits."
      why: "Vague, not specific"

    - content: |
        Key Takeaways:
        • Code reviews improve quality
        • Catch bugs early
        • Share knowledge across team
        • Reduce production incidents
      why: "POWERPOINT STYLE - bullet fragments instead of prose. Reads like slides."
      format: "bullets"

    - content: |
        Engineers have different responsibilities:
        • Junior: Learn and deliver tasks
        • Mid: Own features
        • Senior: Mentor and architect
      why: "Bullets hiding tabular data. Should be a table with columns for Level/Scope/Focus."
      format: "bullets"

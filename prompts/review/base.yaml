# Quality Review - Post-Generation Review and Revision
# Version: 1.0.0
# Context: Final quality control step that reviews generated blog content and
#          enforces strict standards for brevity, clarity, and professionalism.
#          Acts as a senior editor with limited time who demands excellence.

name: "quality-review"
version: "1.0.0"
description: "Senior editor review that enforces wiki-style brevity and quality standards"

context: |
  This prompt is the SECOND CALL in a 2-call quality review workflow.

  The first call (structural-analysis.yaml) has already identified specific issues.
  This prompt FIXES those issues by revising the content.

  Focus: Apply targeted fixes to eliminate:
  - Verbosity and redundancy
  - PowerPoint-style bullets
  - Lack of structure (missing tables where appropriate)
  - AI slop and corporate jargon
  - Unclear or vague language

# System-level instructions
system_prompt: |
  You are a SENIOR EDITOR revising blog content based on identified quality issues.

  CONTEXT:
  A structural analysis has already identified specific problems in this draft.
  Your job is to FIX those issues by revising the content.

  YOUR ROLE:
  - Apply targeted fixes to address each identified issue
  - RUTHLESSLY cut verbosity while preserving essential information
  - Convert PowerPoint-style content to wiki-style brevity
  - Ensure every edit improves clarity and conciseness

  REVISION CRITERIA (NON-NEGOTIABLE):
  
  1. LENGTH CHECK:
     - Count total words in the draft
     - Target: 350-500 words for full blog, 50-70 words per section
     - If ANY section exceeds 100 words, cut it by 50%
     - If total exceeds 800 words, you FAILED to edit properly
  
  2. REDUNDANCY ELIMINATION:
     - Scan for concepts that appear multiple times
     - Delete ALL repetition - state each idea ONCE
     - If two sections say the same thing, consolidate into one
     - Remove throat-clearing ("As mentioned above", "It's important to note")
  
  3. POWERPOINT DETECTION:
     - Find ALL bullet point lists
     - Convert to prose (1-2 items) OR tables (3+ items with consistent structure)
     - Delete "Key Takeaways" sections entirely - integrate into text
     - Replace sentence fragments with complete thoughts
  
  4. TABLE CONVERSION:
     - Find comparisons described in prose (Junior vs Senior, Option A vs B)
     - Convert to tables with 3-5 columns
     - Ensure tables are COMPLETE - include all data from original prose
  
  5. AI SLOP REMOVAL:
     - Delete: em-dashes (â€”), flowery language, hedging words
     - Delete: "dive deep", "leverage", "at the end of the day", "game-changer"
     - Replace vague terms ("many", "various") with specifics or cut the sentence
  
  6. STRUCTURAL ISSUES:
     - If blog has 10+ sections, consolidate to 5-7 sections
     - Flatten nested subsections unless absolutely critical
     - Ensure each section has ONE clear focus
  
  YOUR OUTPUT:
  Return the REVISED blog post in full markdown format with:
  - Title (# heading)
  - Sections (## headings)
  - Content (prose paragraphs and tables only, NO bullets)
  - Word count should be 40-60% of original if original was bloated
  
  CRITICAL: You are the LAST LINE OF DEFENSE against bloat. Be ruthless.

# User prompt template
user_prompt_template: |
  Revise this blog draft to fix the identified issues.

  NOTE: The user prompt will be prepended with a list of specific issues to fix.
  Focus on addressing those issues while applying general quality standards.

  ORIGINAL DRAFT:
  ---
  {{draft_content}}
  ---

  REVISION GUIDELINES:
  
  1. LENGTH:
     - Cut to 350-500 total words
     - Max 100 words per section
     - Target 50-70 words per section
  
  2. REDUNDANCY:
     - Delete every repeated concept
     - Consolidate overlapping sections
     - Remove throat-clearing phrases
  
  3. FORMAT:
     - Convert bullets to prose or tables
     - NO "Key Takeaways" sections
     - Use tables for 3+ item comparisons
  
  4. CLARITY:
     - Remove AI slop and jargon
     - Replace vague terms with specifics
     - Ensure each section has one clear point
  
  5. STRUCTURE:
     - Consolidate to 5-7 sections if needed
     - Flatten unnecessary subsections
  
  Return the complete REVISED blog post in markdown format.
  
  IMPORTANT: Be RUTHLESS. Short is good. If you only cut 10%, you failed.
  Target: Cut 40-60% of original word count while preserving all essential information.

# Quality criteria for the review output
quality_criteria:
  - "Total word count: 350-500 words"
  - "No section exceeds 100 words"
  - "Zero bullet point lists"
  - "No 'Key Takeaways' sections"
  - "Tables used for comparisons (not prose lists)"
  - "No em-dashes or AI slop phrases"
  - "No redundancy across sections"
  - "5-7 sections maximum"
  - "Complete sentences, not fragments"

# Mock response for testing (when BLOGINATOR_LLM_MOCK=true)
mock_response: |
  # Engineering Leadership Best Practices
  
  ## What Makes Effective Technical Leaders
  
  Technical leaders balance hands-on work with team enablement. They write code 30-40% of the time while dedicating the rest to architecture decisions, code reviews, and mentoring. This ratio maintains credibility while scaling impact through others.
  
  ## Setting Technical Direction
  
  | Artifact | Audience | Update Frequency |
  |----------|----------|------------------|
  | Tech vision | Executives | Quarterly |
  | Architecture docs | Engineers | Per major change |
  | Decision records | Team | Per significant choice |
  
  Leaders document decisions in ADRs (Architecture Decision Records) that capture context, options considered, and rationale. This prevents rehashing settled questions.
  
  ## Code Review as Leadership Tool
  
  Effective leaders review code for patterns, not syntax. They flag architectural concerns, suggest abstractions, and teach through questions rather than directives. Reviews should take 10-15 minutes and focus on one key improvement.
  
  ## Mentoring Without Micromanaging
  
  Give engineers problems, not solutions. Frame challenges with context and constraints, then let them propose approaches. Intervene only when they're stuck or heading toward costly mistakes. This builds judgment faster than prescriptive guidance.
  
  ## Making Technical Decisions Stick
  
  Decisions need three elements: clear owner, written rationale, and rollback criteria. Document in ADRs, communicate in team meetings, and reference in code reviews. When teams deviate, point to the ADR rather than relitigating.
